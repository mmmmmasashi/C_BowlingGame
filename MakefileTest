# Makefile for a C++ project with UnitTest

# Compiler settings
CXX = g++
CXXFLAGS = -Wall
CXXFLAGS += -I"$(CPPUTEST_HOME)/include"
CXXFLAGS += -I"src"
CXXFLAGS += -include "$(CPPUTEST_HOME)/include/CppUTest/MemoryLeakDetectorNewMacros.h"
CFLAGS += -include "$(CPPUTEST_HOME)/include/CppUTest/MemoryLeakDetectorMallocMacros.h"

LDFLAGS = -L"$(CPPUTEST_HOME)/lib"
LDLIBS = -lCppUTest -lCppUTestExt

# Target executable name
TARGET = UnitTest.exe

# ☆srcフォルダ以下に追加したモジュール名をここに半角スペース区切りで追加していく
SRCS_TARGET = Bowling.c

# ☆testフォルダ以下に追加したモジュール名をここに半角スペース区切りで追加していく
SRCS_TEST = UnitTest.cpp

#Path list
SRCPATH_TARGET = $(patsubst %,src/%,$(SRCS_TARGET))
SRCPATH_TEST = $(patsubst %,test/%,$(SRCS_TEST))

# Object files
OBJS += $(patsubst src/%.c,src/obj/%.o,$(SRCPATH_TARGET))
OBJS += $(patsubst test/%.cpp,test/obj/%.o,$(SRCPATH_TEST))

# Build target
all: $(TARGET)

TMP_DIR += test
TMP_DIR += test/obj
TMP_DIR += src/obj

# Rule to link the program
$(TARGET): $(OBJS) | $(TMP_DIR)
	$(CXX) -pthread $(LDFLAGS) $(OBJS) -o $(TARGET) $(LDLIBS)

test/obj/%.o: test/%.cpp | $(TMP_DIR)
	$(CXX) $(CXXFLAGS) -c $< -o $@

src/obj/%.o: src/%.c | $(TMP_DIR)
	$(CXX) $(CXXFLAGS) -c $< -o $@

test:
	mkdir test

test/obj:
	mkdir test/obj

src/obj:
	mkdir src/obj

clean:
	rm -rf test/obj/*.o
	rm -rf src/obj/*.o
	rm  $(TARGET)
